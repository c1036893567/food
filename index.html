<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¤§å­¦ç”Ÿåƒé¥­é€‰æ‹©å›°éš¾ç—‡æ‹¯æ•‘å™¨</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #fff5e6;
        font-family: "Comic Sans MS", "Marker Felt", "å¾®è½¯é›…é»‘", sans-serif;
      }
      .header {
        background-color: #ff9966;
        color: white;
        padding: 20px 0;
        border-radius: 0 0 20px 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      .form-container {
        background-color: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      .result-container {
        display: none;
        background-color: #e6f7ff;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      .progress-container {
        display: none;
        margin: 20px 0;
      }
      .progress-bar {
        background-color: #ff9966;
      }
      .funny-icon {
        font-size: 2rem;
        margin: 0 10px;
      }
      .mood-selector img {
        width: 60px;
        height: 60px;
        margin: 5px;
        cursor: pointer;
        transition: all 0.3s;
        border-radius: 50%;
      }
      .mood-selector img:hover,
      .mood-selector img.selected {
        transform: scale(1.1);
        box-shadow: 0 0 10px #ff9966;
      }
      .funny-input {
        border-radius: 50px;
        padding: 10px 20px;
        border: 2px dashed #ff9966;
      }
      .funny-btn {
        background-color: #ff9966;
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 30px;
        font-weight: bold;
        transition: all 0.3s;
      }
      .funny-btn:hover {
        background-color: #ff7733;
        transform: scale(1.05);
      }
      .result-title {
        color: #ff7733;
        font-weight: bold;
        margin-bottom: 20px;
      }
      .result-food {
        font-size: 2rem;
        font-weight: bold;
        color: #ff5500;
        margin: 20px 0;
      }
      .funny-fact {
        font-style: italic;
        color: #666;
        margin-top: 10px;
      }
      .emoji {
        font-size: 1.5rem;
      }

      /* æ”¹è¿›æ»‘å—æ ·å¼ */
      .form-range::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        background: #ff9966;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s;
      }

      .form-range::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }

      .form-range::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: #ff9966;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s;
      }

      .form-range::-moz-range-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }

      .form-range::-webkit-slider-runnable-track {
        height: 8px;
        background: #ddd;
        border-radius: 4px;
      }

      .form-range::-moz-range-track {
        height: 8px;
        background: #ddd;
        border-radius: 4px;
      }

      .budget-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
      }

      .budget-label {
        font-size: 0.8rem;
        color: #666;
      }
      /* æ·»åŠ é¥¥é¥¿ç¨‹åº¦æ»‘å—çš„ç‰¹æ®Šæ ·å¼ */
      .hunger-labels {
        margin-top: 5px;
      }
      .hunger-labels span {
        width: 20px;
        text-align: center;
        font-size: 0.8rem;
        color: #666;
      }
      .hunger-text {
        margin-top: -5px;
      }
      .hunger-text small {
        flex: 1;
        text-align: center;
        font-size: 0.8rem;
        color: #ff7733;
      }
      /* åœ¨<style>æ ‡ç­¾å†…æ·»åŠ  */
      .result-tip {
        font-weight: bold;
        color: #ff5500;
        font-style: normal;
      }

      .result-tip-content {
        font-style: italic;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header text-center">
        <h1>
          <span class="emoji">ğŸ¤¯</span> å¤§å­¦ç”Ÿåƒé¥­é€‰æ‹©å›°éš¾ç—‡æ‹¯æ•‘å™¨
          <span class="emoji">ğŸ”</span>
        </h1>
        <p class="lead">è¿˜åœ¨ä¸ºåƒä»€ä¹ˆå‘æ„ï¼Ÿè®©æœ¬ç¥å™¨æ‹¯æ•‘ä½ çš„é€‰æ‹©å›°éš¾ç—‡ï¼</p>
      </div>

      <div class="form-container">
        <h3 class="text-center mb-4">
          <span class="emoji">ğŸ”</span> å‘Šè¯‰æˆ‘ä½ çš„æƒ…å†µ
          <span class="emoji">ğŸ“</span>
        </h3>

        <div class="mb-3">
          <label for="budget" class="form-label">ğŸ’° ä»Šæ—¥é¢„ç®—ï¼ˆå…ƒï¼‰</label>
          <input
            type="range"
            class="form-range funny-input"
            min="0"
            max="50"
            step="1"
            id="budget"
            value="15"
          />
          <div class="budget-labels">
            <span class="budget-label">0å…ƒ</span>
            <span class="budget-label">10å…ƒ</span>
            <span class="budget-label">20å…ƒ</span>
            <span class="budget-label">30å…ƒ</span>
            <span class="budget-label">40å…ƒ</span>
            <span class="budget-label">50å…ƒ</span>
          </div>
          <p class="funny-fact">
            å½“å‰é¢„ç®—: <span id="budgetValue">15</span>å…ƒ
            <span class="emoji" id="budgetEmoji">ğŸ˜Š</span>
          </p>
        </div>

        <div class="mb-3">
          <label class="form-label">ğŸ˜Š ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Ÿ</label>
          <div class="mood-selector text-center">
            <img
              src="https://cdn.jsdelivr.net/npm/twemoji@11.0.1/2/svg/1f62d.svg"
              data-mood="sad"
              alt="éš¾è¿‡"
            />
            <img
              src="https://cdn.jsdelivr.net/npm/twemoji@11.0.1/2/svg/1f614.svg"
              data-mood="depressed"
              alt="æŠ‘éƒ"
            />
            <img
              src="https://cdn.jsdelivr.net/npm/twemoji@11.0.1/2/svg/1f610.svg"
              data-mood="normal"
              alt="ä¸€èˆ¬"
            />
            <img
              src="https://cdn.jsdelivr.net/npm/twemoji@11.0.1/2/svg/1f60a.svg"
              data-mood="happy"
              alt="å¼€å¿ƒ"
            />
            <img
              src="https://cdn.jsdelivr.net/npm/twemoji@11.0.1/2/svg/1f60d.svg"
              data-mood="excited"
              alt="å…´å¥‹"
            />
          </div>
          <input type="hidden" id="mood" value="normal" />
        </div>

        <div class="mb-3">
          <label for="weather" class="form-label">â˜€ï¸ ä»Šå¤©å¤©æ°”</label>
          <select class="form-select funny-input" id="weather">
            <option value="sunny">é˜³å…‰æ˜åªš</option>
            <option value="cloudy">å¤šäº‘è½¬æ™´</option>
            <option value="rainy">é˜´é›¨ç»µç»µ</option>
            <option value="hot">çƒ­åˆ°èåŒ–</option>
            <option value="cold">å†·åˆ°å‘æŠ–</option>
            <option value="windy">ç‹‚é£å¤§ä½œ</option>
          </select>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="lastClass" class="form-label">ğŸ“š ä¸Šä¸€èŠ‚è¯¾</label>
            <select class="form-select funny-input" id="lastClass">
              <option value="none">æ²¡æœ‰è¯¾</option>
              <option value="math">é«˜æ•°/çº¿ä»£</option>
              <option value="physics">å¤§å­¦ç‰©ç†</option>
              <option value="programming">ç¼–ç¨‹è¯¾</option>
              <option value="english">è‹±è¯­è¯¾</option>
              <option value="philosophy">é©¬åŸ/æ¯›æ¦‚</option>
              <option value="experiment">å®éªŒè¯¾</option>
              <option value="pe">ä½“è‚²è¯¾</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="nextClass" class="form-label">ğŸ“– ä¸‹ä¸€èŠ‚è¯¾</label>
            <select class="form-select funny-input" id="nextClass">
              <option value="none">æ²¡æœ‰è¯¾</option>
              <option value="math">é«˜æ•°/çº¿ä»£</option>
              <option value="physics">å¤§å­¦ç‰©ç†</option>
              <option value="programming">ç¼–ç¨‹è¯¾</option>
              <option value="english">è‹±è¯­è¯¾</option>
              <option value="philosophy">é©¬åŸ/æ¯›æ¦‚</option>
              <option value="experiment">å®éªŒè¯¾</option>
              <option value="pe">ä½“è‚²è¯¾</option>
            </select>
          </div>
        </div>

        <div class="mb-3">
          <label for="hunger" class="form-label">ğŸ½ï¸ é¥¥é¥¿ç¨‹åº¦</label>
          <input
            type="range"
            class="form-range funny-input"
            min="1"
            max="10"
            id="hunger"
            value="5"
          />
          <div class="d-flex justify-content-between hunger-labels">
            <span>10</span>
            <span>9</span>
            <span>8</span>
            <span>7</span>
            <span>6</span>
            <span>5</span>
            <span>4</span>
            <span>3</span>
            <span>2</span>
            <span>1</span>
          </div>
          <div class="d-flex justify-content-between hunger-text">
            <small>é¥¿åˆ°å‡å¤©</small>
            <small>èƒ½åƒä¸€å¤´ç‰›</small>
            <small>æ­£å¸¸é¥¥é¥¿</small>
            <small>ä¸å¤ªé¥¿</small>
            <small>å®Œå…¨ä¸é¥¿</small>
          </div>
          <p class="funny-fact mt-2">
            å½“å‰çŠ¶æ€: <span id="hungerStatus">æ­£å¸¸é¥¥é¥¿</span>
            <span id="hungerEmoji">ğŸ˜‹</span>
          </p>
        </div>

        <div class="mb-3">
          <label for="energy" class="form-label">âš¡ èƒ½é‡éœ€æ±‚</label>
          <input
            type="range"
            class="form-range funny-input"
            min="1"
            max="10"
            id="energy"
            value="5"
          />
          <div class="d-flex justify-content-between">
            <span>åªæƒ³èººå¹³</span>
            <span>éœ€è¦æç¥</span>
            <span>æ­£å¸¸éœ€æ±‚</span>
            <span>æ´»åŠ›æ»¡æ»¡</span>
            <span>å‡†å¤‡è·‘é©¬æ‹‰æ¾</span>
          </div>
        </div>

        <div class="mb-3">
          <label for="special" class="form-label">ğŸ¯ ç‰¹æ®Šéœ€æ±‚</label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              value="vegetarian"
              id="vegetarian"
            />
            <label class="form-check-label" for="vegetarian"
              >æˆ‘æ˜¯ç´ é£Ÿä¸»ä¹‰è€…</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              value="spicy"
              id="spicy"
            />
            <label class="form-check-label" for="spicy">æˆ‘æƒ³åƒè¾£çš„</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              value="quick"
              id="quick"
            />
            <label class="form-check-label" for="quick">æˆ‘è¦å¿«é€Ÿè§£å†³</label>
          </div>
        </div>

        <div class="text-center mt-4">
          <button id="generateBtn" class="btn funny-btn">
            <span class="emoji">âœ¨</span> ç”Ÿæˆæˆ‘çš„ä¸“å±ç¾é£Ÿ
            <span class="emoji">ğŸ½ï¸</span>
          </button>
        </div>
      </div>

      <div class="progress-container" id="progressContainer">
        <div class="progress">
          <div
            id="progressBar"
            class="progress-bar progress-bar-striped progress-bar-animated"
            role="progressbar"
            style="width: 0%"
          ></div>
        </div>
        <p class="text-center mt-2" id="progressText">
          æ­£åœ¨åˆ†æä½ çš„é€‰æ‹©å›°éš¾ç—‡ç¨‹åº¦...
        </p>
      </div>

      <div class="result-container" id="resultContainer">
        <h3 class="result-title text-center">
          <span class="emoji">ğŸ‰</span> ä½ çš„ä¸“å±ç¾é£Ÿæ¨è
          <span class="emoji">ğŸ´</span>
        </h3>
        <div class="text-center">
          <p class="result-food" id="resultFood">é»„ç„–é¸¡ç±³é¥­</p>
          <p id="resultReason" class="funny-fact">
            æ ¹æ®ä½ çš„é¢„ç®—15å…ƒã€å¿ƒæƒ…ä¸€èˆ¬å’Œå¤©æ°”é˜³å…‰æ˜åªšï¼Œè¿™é“èœæœ€é€‚åˆä½ ï¼
          </p>
          <p class="funny-fact">
            <span class="result-tip">å°è´´å£«ï¼š</span>
            <span class="result-tip-content" id="resultTip"
              >è®°å¾—åŠ ä»½ç±³é¥­ï¼Œä¸ç„¶ä¼šé¥¿ï¼</span
            >
          </p>
          <button id="tryAgainBtn" class="btn funny-btn mt-3">
            <span class="emoji">ğŸ”„</span> å†è¯•ä¸€æ¬¡ <span class="emoji">ğŸ¤ª</span>
          </button>
        </div>
      </div>
    </div>

    <script>
      // é¢„ç®—æ»‘å—äº‹ä»¶
      document.getElementById("budget").addEventListener("input", function () {
        updateBudgetDisplay(this.value);
      });

      // æ›´æ–°é¢„ç®—æ˜¾ç¤ºçš„å‡½æ•°
      function updateBudgetDisplay(budget) {
        document.getElementById("budgetValue").textContent = budget;

        // æ ¹æ®é¢„ç®—æ”¹å˜è¡¨æƒ…
        let emoji = "ğŸ˜Š";
        if (budget < 5) emoji = "ğŸ˜±";
        else if (budget < 10) emoji = "ğŸ˜…";
        else if (budget > 30) emoji = "ğŸ’°";
        else if (budget > 40) emoji = "ğŸ¤‘";

        document.getElementById("budgetEmoji").textContent = emoji;
      }

      // å¿ƒæƒ…é€‰æ‹©å™¨äº‹ä»¶
      const moodImages = document.querySelectorAll(".mood-selector img");
      moodImages.forEach((img) => {
        img.addEventListener("click", function () {
          moodImages.forEach((i) => i.classList.remove("selected"));
          this.classList.add("selected");
          document.getElementById("mood").value = this.dataset.mood;
        });
      });

      // é»˜è®¤é€‰æ‹©"ä¸€èˆ¬"å¿ƒæƒ…
      moodImages[2].classList.add("selected");

      // é¥¥é¥¿ç¨‹åº¦æ»‘å—äº‹ä»¶
      document.getElementById("hunger").addEventListener("input", function () {
        const hunger = parseInt(this.value);
        let status = "";
        let emoji = "";

        if (hunger === 1) {
          status = "é¥¿åˆ°å‡å¤©";
          emoji = "ğŸ˜«";
        } else if (hunger <= 3) {
          status = "èƒ½åƒä¸€å¤´ç‰›";
          emoji = "ğŸ®";
        } else if (hunger <= 5) {
          status = "æœ‰ç‚¹é¥¿";
          emoji = "ğŸ˜‹";
        } else if (hunger <= 7) {
          status = "æ­£å¸¸é¥¥é¥¿";
          emoji = "ğŸ¤¤";
        } else if (hunger <= 9) {
          status = "ä¸å¤ªé¥¿";
          emoji = "ğŸ¤”";
        } else {
          status = "å®Œå…¨ä¸é¥¿";
          emoji = "ğŸ˜Œ";
        }

        document.getElementById("hungerStatus").textContent = status;
        document.getElementById("hungerEmoji").textContent = emoji;
      });

      // ç”ŸæˆæŒ‰é’®äº‹ä»¶
      document
        .getElementById("generateBtn")
        .addEventListener("click", async function () {
          // ç¡®ä¿è·å–æœ€æ–°çš„è¡¨å•å€¼
          const currentBudget = document.getElementById("budget").value;
          updateBudgetDisplay(currentBudget);

          // æ˜¾ç¤ºè¿›åº¦æ¡
          document.getElementById("progressContainer").style.display = "block";
          document.querySelector(".form-container").style.display = "none";

          // æ¨¡æ‹Ÿè¿›åº¦æ¡
          let progress = 0;
          const progressBar = document.getElementById("progressBar");
          const progressText = document.getElementById("progressText");
          const interval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress > 100) progress = 100;
            progressBar.style.width = progress + "%";

            // æ›´æ–°è¿›åº¦æ–‡æœ¬
            if (progress < 30) {
              progressText.textContent = "æ­£åœ¨åˆ†æä½ çš„é€‰æ‹©å›°éš¾ç—‡ç¨‹åº¦...";
            } else if (progress < 60) {
              progressText.textContent = "æ­£åœ¨è®¡ç®—é£Ÿå ‚æ’é˜Ÿæ—¶é—´...";
            } else if (progress < 90) {
              progressText.textContent = "æ­£åœ¨è€ƒè™‘å®¿ç®¡é˜¿å§¨çš„è„¸è‰²...";
            } else {
              progressText.textContent = "å·®ç‚¹è¢«å¤–å–å°å“¥æ‰“æ–­...";
            }

            if (progress === 100) {
              clearInterval(interval);
            }
          }, 200);

          try {
            // æ”¶é›†è¡¨å•æ•°æ®
            const formData = {
              budget: parseInt(document.getElementById("budget").value),
              mood: document.getElementById("mood").value,
              weather: document.getElementById("weather").value,
              lastClass: document.getElementById("lastClass").value,
              nextClass: document.getElementById("nextClass").value,
              hunger: parseInt(document.getElementById("hunger").value),
              energy: parseInt(document.getElementById("energy").value),
              vegetarian: document.getElementById("vegetarian").checked,
              spicy: document.getElementById("spicy").checked,
              quick: document.getElementById("quick").checked,
            };

            // å‘é€è¯·æ±‚åˆ°åç«¯
            const response = await fetch(
              "/api/recommend-food",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              }
            );

            if (!response.ok) {
              throw new Error("ç½‘ç»œå“åº”ä¸æ­£å¸¸");
            }

            const result = await response.json();

            // æ˜¾ç¤ºç»“æœ
            showResult(result);
          } catch (error) {
            console.error("è·å–æ¨èå¤±è´¥:", error);
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            document.getElementById("progressContainer").style.display = "none";
            document.querySelector(".form-container").style.display = "block";
            alert("è·å–æ¨èå¤±è´¥ï¼Œè¯·ç¨åå†è¯•: " + error.message);
          }
        });

      // æ˜¾ç¤ºç»“æœ
      function showResult(data) {
        document.getElementById("progressContainer").style.display = "none";
        document.getElementById("resultContainer").style.display = "block";

        // æ˜¾ç¤ºç»“æœ
        document.getElementById("resultFood").textContent =
          data.food || "æœªçŸ¥ç¾é£Ÿ";
        document.getElementById("resultReason").textContent =
          data.reason || "AIæ­£åœ¨æ€è€ƒ...";
        document.getElementById("resultTip").textContent =
          data.tip || "å°è´´å£«ï¼šå¥½å¥½äº«å—ä½ çš„ç¾é£Ÿå§ï¼";
      }

      // å†è¯•ä¸€æ¬¡æŒ‰é’®
      document
        .getElementById("tryAgainBtn")
        .addEventListener("click", function () {
          // éšè—ç»“æœå®¹å™¨
          document.getElementById("resultContainer").style.display = "none";
          // æ˜¾ç¤ºè¡¨å•å®¹å™¨
          document.querySelector(".form-container").style.display = "block";

          // ç¡®ä¿é¢„ç®—æ˜¾ç¤ºæ›´æ–°
          const currentBudget = document.getElementById("budget").value;
          updateBudgetDisplay(currentBudget);
        });

      // åˆå§‹åŒ–é¢„ç®—æ˜¾ç¤º
      updateBudgetDisplay(document.getElementById("budget").value);
    </script>
  </body>
</html>
